# 运放参数说明

## 输入失调电压(Input Offset Voltage) $V_{OS}$

输入失调电压的定义：强迫让运放输出电压为0V时，所施加在差动输入端的电压值（即正向输入端 — 反向输入端）。输入失调电压的电压范围一般是在$mV$~$uV$级。

输入失调电压可以被建模至运放内部。相当于一个理想电压源连接至理想运放输入端。

![image-20250521192028980](运放参数.assets/image-20250521192028980.png)改变Power Supply Voltage 电源供应电压和Common mode voltage 共模电压将会影响输入失调电压。 

运放内部的主要原理是模电中的差分放大电路。两个三极管Q1和Q2的不匹配会导致输入失调电压的产生。

![image-20250521192122012](运放参数.assets/image-20250521192122012.png)

### 输入失调电压造成的输出电压误差

![image-20250522000412603](运放参数.assets/image-20250522000412603.png)

## 输入偏置电流(Input Bias Current) $I_B$

输入偏置电流定义：流入运放输入端的电流。如图所示，这个电流可以被建模成一个理想电流源。

![image-20250521230748674](运放参数.assets/image-20250521230748674.png)

## 输入偏差(失调)电流(Input (bias) offset current)

输入偏差(失调)电流定义：如上图所示，运放正向输入端和反向输入端的两个输入偏置电流的差值。如果输入偏差电流很低，那它可以跟各个输入端的输入阻抗匹配，进而消除输入偏置电流所造成的电压偏压误差。

在BJT放大器里面，输入偏置电流是指分别流入BJT输入对的基极电流。一般而言，BJT放大器的偏置电流会大于MOSFET和JFET放大器，Typical(典型)值在几百个$nA$这个范围。在一些精准BJT放大器里，使用一种方法称为Bias Current Consolation，抵消偏置电流来达到偏置电流最小化。这个方法是做在运放芯片内部，不需要额外的外部器件。使用这个方法的运放可以使原本有数百个$nA$的偏置电流，降至数个$nA$。

## 输入偏置电流和输入偏差电流的总结

在MOSFET或JFET的运算放大器里面，ESD保护二极体的漏电流是造成输入偏置电流的主要因素。MOSFET栅极输入端拥有相当低的漏电流，所以它并不会产生很大的偏置电流。

![image-20250521233808682](运放参数.assets/image-20250521233808682.png)

虽然MOSFET和JFET的运放的输入偏置电流的25℃下一班在几十个$pA$的量级。但在MOSFET的运放下，没升高10℃，输入偏置电流会变为原来的两倍。

### 输入偏置电流造成的输出电压误差

![image-20250522000524162](运放参数.assets/image-20250522000524162.png)

![image-20250522000657216](运放参数.assets/image-20250522000657216.png)

![image-20250522000714414](运放参数.assets/image-20250522000714414.png)

## 输入输出限制(Input & Output Limitations)

使用一个运放组成的电压跟随器，常见这样的现象：

![image-20250524164519247](运放参数.assets\image-20250524164519247.png)

术语定义：

* 共模电压(Common Mode Voltage) $V_{CM}$：放大器两个输入端的平局电压。对于运放来说，它的两个输入端电平几乎是一样的，两者只相差一个很小的 Offset 输入失调电压值。所以在每一个输入端上都能看到这个共模信号。

  ![image-20250524164603865](运放参数.assets\image-20250524164603865.png)

* 共模输入电压范围(Input Voltage Swing)：又称输入电压摆幅。它定义了运放正常线性工作所需的输入共模电压范围。共模输入电压范围通常是相对于正电源和负电源而定义的。如果超过这个共模输入范围，输出信号会变成非线性。

* 输出电压摆幅(Output Voltage Swing)：是指输出信号线性工作时的输出电压范围。输出摆幅同样也是相对于供电电源而定义的。如果超过运放的输出电压摆幅参数指标，输出信号将会失真或者出现非线性。

  ![image-20250524165351297](运放参数.assets\image-20250524165351297.png)

  相对于电源定义的解释，如下图。

  ![image-20250524165712715](运放参数.assets\image-20250524165712715.png)

常见的**轨对轨运放指的是**共模输入电压范围可以达到供电电源的两个轨，并且输出电压接近供电电源轨的放大器。

### $V_{CM}$ TWO Examples

如下图所示，左侧为反相比例放大器，右侧为同相比例放大器。两者考虑输入共模电压这个参数时是不同的。

左侧的反相比例放大电路的同相端接地，为0V。则反相输入端的电压也约等于0V。所以这个电路的共模输入电压即为0V。并且不论输入信号如何变化，共模输入电压都是保持在0V不变的。

右侧的同相比例放大器输入信号接到同相输入端，这样一来共模信号就会收到输入信号钳制。换句话说，如果输入信号变化，共模信号也会随之变化使用这种配置时，一定要注意避免超过运放的共模电压限制。

![image-20250524170427425](运放参数.assets\image-20250524170427425.png)

## Input $V_{CM}$ or Output Voltage Probelm?

### Example One

![image-20250526095830567](运放参数.assets\image-20250526095830567.png)

这个一个运算放大器搭建的Buffer缓冲器，正常情况下，我们会看到输出是0V，或者是一个很小的输出误差信号，这个信号是和输入失调电压$V_{OS}$相关的。但是如果我们做DC仿真，会发现输出端的电压值接近200mV，然而最大的失调电压值才是120uV。

根据共模输入电压范围和输出电压摆幅两个参数分别计算得到$-0.1V<V_{IN}<1.5V$，$0.2V<V_{OUT}<4.8V$。

由于我们的输入电压是0V，运放的输出端也将跟随到0V，但是这已经低于输入电压范围的最小值。因此这时输出电压只能达到接近0.2V的一个最小值，即仿真中得到的171mV。

### Example Two

![image-20250526100749920](运放参数.assets\image-20250526100749920.png)

![image-20250526100811990](运放参数.assets\image-20250526100811990.png)

## 带宽(BandWidth)

[5.1 带宽 1_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV19Y4y1r7zg?spm_id_from=333.788.videopod.episodes&vd_source=0c6e9aa27976c7e534f51b25bcdd53f0&p=10)

* 认识增益(gain)

* 如何用线性或者是分贝来表示增益

* 零点(zeros)和极点(pulse)

  ![image-20250526115324204](运放参数.assets\image-20250526115324204.png)

* 波特图(Bode plots)

* 截止频率(Cutoff frequency)和带宽(BandWidth)的定义

[5.2 带宽 2_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV19Y4y1r7zg?spm_id_from=333.788.videopod.episodes&vd_source=0c6e9aa27976c7e534f51b25bcdd53f0&p=11)

* 开环回路增益(open loop gain)

  ![image-20250526115135507](运放参数.assets\image-20250526115135507.png)

  方框中的最后一行的$A_{cl}$是常见的同相放大器闭环回路增益公式。需要注意的是，**这个公式仅适用于开环增益非常高时。**

  然而在现实世界中，运放的开环回路增益具有低频的主极点(dominnant pole)。如图所示可以被看作是一个RC filter滤波器。此仿真描绘了真实世界运放的开环回路增益。在直流或低频，$A_{ol}$是非常大的。在这种情况下它是120dB或100万V/V。随着频率的增加，$A_{ol}$以-20dB/dec的速率降低。在图中，我们看到在10MHz时，开环回路增益为0dB或1V/V。

  ![image-20250526135050644](运放参数.assets\image-20250526135050644.png)

* 闭环回路增益(closed loop gain)

  开环回路增益对闭环回路增益的影响：闭环回路增益在低频时为$1/\beta$，在高频时为$A_{ol}$。**我们定义电路的带宽为$1/\beta$和$A_{ol}$曲线相交的频率。**

  ![image-20250526140240241](运放参数.assets\image-20250526140240241.png)![image-20250526140637449](运放参数.assets\image-20250526140637449.png)

  然而，请注意X轴是对数的，因此以图形方式选定的带宽可能不够精确。

* 增益带宽积(gain bandwidth product)

  增益带宽积时线性增益和带宽的乘积，因此给定两个变数中的一个可以得到另外一个的解。计算过程可如下图左侧红色方框中的内容所示。（由此计算过程我认为增益带宽积是开环回路增益与带宽的乘积，须在开环回路增益满足-20dB/dec的下降区域内有效）请注意，计算出的带宽需当$A_{ol}$局限于-20dB/dec的速率下降才是有效的，虽然大部分的运算放大器都符合，但也有些特定的增益带宽积是有限的范围。

  ![image-20250526140929392](运放参数.assets\image-20250526140929392.png)

  此外，考虑到数据表有增益带宽积和$A_{ol}$曲线的典型值，通常可以预期该值在室温下的变异数高达$\pm30\%$。在规定的温度范围外，可能有附加$\pm30\%$误差的变化。因此，当考虑到放大器的放大带宽时，应在设计时保留设计裕度。

* 静态电流(Quiescent Current)与带宽(BandWidth)的关系

  在一般的情况下，较宽的带宽运算放大器需要较多的静态电流。原理如下图所示。观察双极型晶体管和MOSFET的转导(Transductions)(又叫电流增益)。可以看出基极(collector)和漏极(drain)电流的直接关系。转导取倒数可得阻抗或$r_{gm}$，$r_{gm}$是运放内部第一级的动态输出阻抗，此输出阻抗驱动米勒电容$C_c$，$r_{gm}$和$C_c$的串联组合形成一个低通滤波器。该低通滤波器的主机点产生放大器内部的带宽。图中第四个公式显示增加电流消耗直接增加双极型运算放大器的带宽。但是如果是MOSFET，带宽将依漏极电流平方根的比例增加。

  ![image-20250526144441433](运放参数.assets\image-20250526144441433.png)

* 仿真电路带宽并验证计算结果

[5.3 带宽 3_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV19Y4y1r7zg?spm_id_from=333.788.player.switch&vd_source=0c6e9aa27976c7e534f51b25bcdd53f0&p=12)

* 主极点(低频极点)

  主极点是在$A_{ol}$图中当$A_{ol}$开始随频率下降的点。于发展macro模型时，此参数非常重要。极点频率可以从$A_{ol}$曲线来估计，但更准确的方法是使用增益带宽积及开环回路增益$A_{vol}$来计算。计算过程详见下图左下方框。需要说明的是，这个计算的思路是利用增益带宽积的定义计算开环回路增益最大时对应的频率，即可得到主极点的频率。
  
  ![image-20250527102256082](运放参数.assets\image-20250527102256082.png)
  
* 可变的增益带宽积

  ![image-20250527110610267](运放参数.assets\image-20250527110610267.png)

  需要注意的时当开环回路增益小于50时，增益带宽积不再为常数。当开环回路增益小于12时，相位裕度(Phase margin)小于-180°，系统不稳定，理论上会产生自激振荡。

* 使用同相增益(none inverting gain)来计算带宽

  如图所示，无论是同相比例放大电路还是反向比例放大电路。在计算带宽时所使用的增益的均定义为$gain=1+\frac{R_f}{R_1}$，这个增益$gain$是同相组态的增益，即同相增益，通常被称噪声增益(Noise gain) 。图中右上图显示了手算理论结果和仿真结果的吻合。即计算运放的带宽时，应使用噪声增益$1+\frac{R_f}{R_1}$计算运放带宽。

  **个人理解：使用增益带宽积计算带宽是利用增益带宽积为常数寻找$1/\beta$与$A_{ol}$曲线的交点即为带宽。完全是按照带宽的定义计算的。**

  ![image-20250527113427444](运放参数.assets\image-20250527113427444.png)

* 为何使用同相增益(none inverting gain)来计算带宽

  根据同相组态和反向组态的控制框图可知对应的系统传递函数在时域的表达形式。可计算出同行组态和反向组态的增益如下图二所示。二者除前馈因子$\alpha$外形式相同，且$\alpha$为常数。故二者的增益表达式除$\alpha$外形式相同，均与变量$\beta$有关。由于$\frac{1}{\beta}=\frac{R_f}{R_1}+1$为同相增益。所以反相组态和同相组态的带宽均由同相增益来决定。

  ![image-20250527133814065](运放参数.assets\image-20250527133814065.png)![image-20250527162532969](运放参数.assets\image-20250527162532969.png)

* 高频极点的位置对带宽的二次效应

  将之前的仿真的运放进行更换。之前的仿真中是使用的是简化的单极点运算放大器模型，而本次仿真更换为实际的OPA827运放。Bandwidth的计算与之前相同，计算出反向放大器的带宽为11MHz，用于缓冲器的同行放大器带宽为22MHz。而当仿真电路时，带宽分别为18MHz和34.7MHz。原因是现实世界中的运算放大器和强大的仿真模型有多个极点。在他们的开环回路增益或$A_{ol}$曲线，我们已经讨论了一个低频极点的存在或主极点，其他极点通常呗设计在元件的单位增益带宽之外，然而其他极点仍然会影响带宽。

  ![image-20250527164635966](运放参数.assets\image-20250527164635966.png)

  此页的左侧描述了$A_{ol}$和一个简化的仿真相位曲线。请注意，只有主极点出现在$A_{ol}$曲线。我们看到对应的相位图中，由于主极点产生了相应90°的相移。在更高的频率范围内，很明显的是没有额外的极点，因为相位曲线保持不变。相位只于极点频率的是被聘之前那开始改变。

  此页右侧我们看到$A_{ol}$和相位曲线更全面的双极点仿真模型。在此，我们看到在低频的主极点存在。着眼于相位曲线，我们看到一个相位于高频移动，这表示一个高频极点存在。请注意，即使极点的位置超出单位增益带宽，但它仍能影响元件的相位。

  ![image-20250527165450375](运放参数.assets\image-20250527165450375.png)

  在$A_{ol}$曲线的第二个极点，会影响运算放大器闭环回路相应的幅值和相位。实际上，有两个或多个极点的$A_{ol}$曲线放大器的闭环回路响应是由下图右下角的传递函数来求得的。其中$s=j\omega$，$\omega$是自然频率，$\zeta$是阻尼因数。使用对数图绘制二阶系统的幅值在不同$\zeta$下的增益与频率的关系，以dB为单位。请注意，当第二个极点的频率高于unit frequency，此时$\zeta$的值较大，并没有gain peaking 的影响。然而如果第二极点的频率接近unit gain frequency，此时$\zeta$的值小，并受gain peaking 的影响很大。gain peaking发生在现实世界中的运算放大器，并建立在大多数运算放大器模型中。当频率接近natural frequency，gain peaking将导致误差并会影响带宽。

  ![image-20250527171127268](运放参数.assets\image-20250527171127268.png)

  **闭环回路的带宽会随着第二极点频率的降低而增加。当第二极点接近单位增益带宽，闭环回路带宽停止变化，我们会看到显著的gain peaking。**值得一提的是 peaking effect只会发生于低增益。现在应注意的是运放第二极点的位置关系到可能出现gain peaking。此外这种影响通常是包含在SPICE运算放大器的macro-model中，该峰值的大小一般在几分贝，并且对带宽变化的影响应小于2倍。

  ![image-20250527172341411](运放参数.assets\image-20250527172341411.png)

  ![image-20250527172633073](运放参数.assets\image-20250527172633073.png)

[5.4 带宽 4_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV19Y4y1r7zg?spm_id_from=333.788.videopod.episodes&vd_source=0c6e9aa27976c7e534f51b25bcdd53f0&p=13)

* $A_{ol}$曲线的斜率如何影响增益带宽

  * 增益带宽在不同闭环回路增益有些偏差是不常见的，而该偏差量将取决于放大器而异
  * 寻找一个零点或极点，相位曲线是关键。所以除了检查开环回路增益曲线，也要检查相位曲线。
  * 不要指望在数据表中列出带宽性能的确切性。应为典型带宽规格在不同的制程约有$\pm30\%$和不同温度下$\pm30\%$的变异。因此强烈建议在设计时对带宽要留显著的裕度。

  ![image-20250527232956708](运放参数.assets/image-20250527232956708.png)

* 为何运放的输入电容能够限制带宽

  所有运算放大器有差模和共模输入电容和阻抗，这种寄生电容是由于输入极晶体管的半导体界面造成的。差模电容之间连接到两个输入端，共模电容被连接在各输入相对于交流接地。表格中通常会显示输入电容。

  如下图所示的例子中，差模电容是1.6pF，共模电容是6.4pF。输入电容都比较小，所以这种情况下是不可能看到带宽的限制的，除非输入信号源具有大的串联电阻。在这个例子中，信号源电阻是比较大的1MΩ，原电阻和共模输入电容组成低通滤波器。对应的截止频率为24.87kHz。请注意，差模电容和反相输入端的共模电容未包括在带宽计算内。这是因为运算放大器的回授消除了这些电容。

  ![image-20250527234107871](运放参数.assets/image-20250527234107871.png)

  输入电容是TI的运算放大器模型的一部分，所以可以通过仿真得到结果。

  ![image-20250527234343579](运放参数.assets/image-20250527234343579.png)

* 如何计算放大器电路的实际增益和带宽

  计算方法

  ![image-20250529101943963](运放参数.assets/image-20250529101943963.png)

  **结论**：随着频率的增加，当接近截止频率时，闭回路增益减少。**所以如果需要设计一个在高频精确的增益，截至频率应相对增加。**

* 如何运用feedback capcitor来限制电路的带宽

* 了解slew rate即压摆率它是如何影响不同带宽的响应的